<?xml version="1.0" encoding="UTF-8"?>
<project name="org.rubypeople.rdt.doc.user" default="nodefault" basedir=".">
	
	<target name="nodefault">		
		<echo message="Please always call this script from build.xml"/>
	</target>

	<target name="init">
		<fail unless="featureVersion" message="Property featureVersion must be set. Please always call this script from build.xml"/>
		<fail unless="featureVersion" message="Property docbook.root must be set. Please always call this script from build.xml"/>
        <property name="docbook.xsl.dir" value="${docbook.root}/docbook-xsl-1.64.1"/>
        <property name="docbook.dtd.dir" value="${docbook.root}/dtd"/>	
		<condition property="docbook.dir.exists">
	      <available file="${docbook.root}"/>
		</condition>	 	
	</target>

	<target name="clean.docbook.generated">
	    <delete file="toc.xml"/>
	    <delete file="docbook.done"/>
	    <delete>
	      <fileset dir="html" includes="*.html"/>
	    </delete>
	    <delete file="customizationLayerCopy.xsl"/>
	</target>
	
	<target name="replaceVarInCustomizationLayer">
	   <copy file="customizationLayer.xsl" tofile="customizationLayerCopy.xsl"/>
	   <replace file="customizationLayerCopy.xsl">	   
	     <replacefilter token="@@VERSION@@" value="${featureVersion}"/>
         <replacefilter token="@@DOCBOOKROOT@@" value="${docbook.root}"/>
      </replace>
	</target>

	<target name="replaceVersionInPluginXml">
	   <replace file="plugin.xml">	   
	     <replacefilter token="1.0" value="${featureVersion}"/>
      </replace>
	</target>
	
	<target name="html" depends="init,clean.docbook.generated,replaceVarInCustomizationLayer" if="docbook.dir.exists">
	 <!--${docbook.xsl.dir}/eclipse/eclipse.xsl -->
      <style includes="docbook.xml" basedir="." destdir="."  extension=".done" style="customizationLayerCopy.xsl">
        <param name="base.dir" expression="html/"/>
        <param name="manifest.in.base.dir" expression="0"/>
        <param name="eclipse.plugin.id" expression="org.rubypeople.rdt.doc.user"/>
        <param name="eclipse.plugin.name" expression="Ruby Development Documentation"/>
        <param name="eclipse.plugin.provider" expression="RubyPeople, Inc."/>
        <xmlcatalog id="docbook.catalog">
     	 <dtd publicId="-//OASIS//DTD DocBook V3.1//EN" location="${docbook.dtd.dir}/docbookx.dtd"/>
        </xmlcatalog>
       </style>
       <antcall target="replaceVersionInPluginXml"/>
     </target>

</project>
